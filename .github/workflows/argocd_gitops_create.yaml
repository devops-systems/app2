name: ARGOCD GITOPS CREATE

on:
  create

jobs:
  Test: 
    runs-on: 'ubuntu-latest'
    steps:
      - name: Get envs                 
        run: |
          env
      - name: Checkout ArgoCD GitOps repo
        uses: actions/checkout@master
        with:
          repository: devops-systems/argocd-gitops
      - name: Get folders                 
        run: |
          ls -al
      - name: Generate variables                 
        run: |
          export REPO=$(echo $GITHUB_REPOSITORY | cut -d "/" -f2)
          export BRANCH=$GITHUB_REF_NAME
          export IMAGE_TAG=$GITHUB_SHA
      - name: Generate file 
        run: |
          cat templates/argocd_gitops_features.yaml | kyml tmpl -e REPO -e BRANCH -e IMAGE_TAG | tee apps-features/$REPO-$BRANCH.yaml
